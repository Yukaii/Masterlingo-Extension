{"version":3,"file":"content/content.js","sources":["webpack:///webpack/bootstrap","webpack:///./src/content/TranslationBox.js","webpack:///./src/content/content.js","webpack:///./src/content/supermemo.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/content/content.js\");\n","class TranslationBox {\r\n  constructor() {\r\n    let boxElement = document.createElement('div');\r\n    boxElement.className = 'masterlingo__translation-box';\r\n    document.querySelector('body').appendChild(boxElement);\r\n    this.domSelector = document.querySelector('.masterlingo__translation-box');\r\n    this.isActive = false;\r\n    this.activeClass = 'masterlingo__translation-box--active';\r\n  }\r\n\r\n  show(wordElement, flashcard = false) {\r\n    this.active = true;\r\n    this.domSelector.classList.add(this.activeClass);\r\n\r\n    if (flashcard) {\r\n      const translations = flashcard.inverted ? flashcard.original : flashcard.translations,\r\n        original = !flashcard.inverted ? flashcard.original.join(', ') : flashcard.translations.join(', ');\r\n      let translationsHtml = translations.map(translation => {\r\n        return `<div class=\"masterlingo__translation\">${translation}</div>`;\r\n      });\r\n      const rateButtons = [\r\n        { name: 'incorrect', quality: 1 },\r\n        { name: 'correct', quality: 4 },\r\n        { name: 'easy', quality: 5 }\r\n      ];\r\n      const rateButtonsHtml = rateButtons.map(rateButton => {\r\n        return `<div class=\"masterlingo__rating-button masterlingo__rating-button--easy\" >${rateButton.name}</div>`;\r\n      });\r\n\r\n      // update DOM\r\n      const volumeIconSrc = chrome.extension.getURL('assets/volume.svg');\r\n      console.log(volumeIconSrc);\r\n      this.domSelector.innerHTML = `<div class=\"masterlingo__original-word--container\"><div class=\"masterlingo__original-word\">${original}</div><img src=\"${volumeIconSrc}\" class=\"masterling__original-word--audio material-icons\" /></div><div class=\"masterlingo__translations-container\">${translationsHtml}</div><div class=\"masterlingo__rating-buttons\">${rateButtonsHtml}</div>`;\r\n      this.setPosition(wordElement);\r\n      // flashcard mode\r\n    } else {\r\n      // need to fetch translations first\r\n    }\r\n  }\r\n\r\n  setPosition(wordElement) {\r\n    const wordOffset = this.getOffset(wordElement);\r\n    this.domSelector.style.left = wordOffset.left + wordElement.offsetWidth / 2 + 'px';\r\n    this.domSelector.style.top = wordOffset.top + 'px';\r\n  }\r\n\r\n  getOffset(element) {\r\n    const rect = element.getBoundingClientRect();\r\n    return {\r\n      left: rect.left + window.scrollX,\r\n      top: rect.top + window.scrollY\r\n    };\r\n  }\r\n\r\n  hide() {\r\n    this.active = false;\r\n    this.domSelector.classList.remove(this.activeClass);\r\n  }\r\n}\r\n\r\nexport default TranslationBox;\r\n","import TranslationBox from './TranslationBox';\r\nimport supermemo from './supermemo';\r\n\r\nfunction runContentScript() {\r\n  let config = { native: '', foreign: '', loggedIn: false },\r\n    flashcards,\r\n    translationBox;\r\n  const spanCode = '-198987';\r\n\r\n  const readyStateCheckInterval = setInterval(function() {\r\n    if (document.readyState === 'complete') {\r\n      clearInterval(readyStateCheckInterval);\r\n\r\n      // ----------------------------------------------------------\r\n      // This part of the script triggers when page is done loading\r\n      console.log('Hello. This message was sent from scripts/inject.js');\r\n      // ----------------------------------------------------------\r\n\r\n      chrome.runtime.sendMessage({ method: 'get', function: 'config' }, function(response) {\r\n        if (response) {\r\n          console.log(response);\r\n          config = { ...config, foreign: response.foreign, native: response.native, loggedIn: true };\r\n          init();\r\n          console.log(flashcards);\r\n        }\r\n      });\r\n    }\r\n  }, 100);\r\n\r\n  async function init() {\r\n    getFlashcards(highlightPageWords);\r\n    translationBox = new TranslationBox();\r\n  }\r\n\r\n  function getFlashcards() {\r\n    // get flashcards from bg script\r\n    chrome.runtime.sendMessage({ method: 'get', function: 'flashcards' }, response => {\r\n      if (response) {\r\n        console.log('response is:');\r\n        console.log(response);\r\n        flashcards = response;\r\n        highlightPageWords(flashcards.allFlashcards);\r\n      } else {\r\n        console.log(`couldn't get flashcards`);\r\n      }\r\n    });\r\n  }\r\n\r\n  function highlightPageWords(flashcards) {\r\n    let pageElements = document.querySelectorAll('p, span'),\r\n      elementHtml;\r\n    for (let pageElement of pageElements) {\r\n      // loop over all elements\r\n      elementHtml = pageElement.innerHTML;\r\n      let noDuplicatesArray = [];\r\n      Object.values(flashcards).forEach(flashcard => {\r\n        // loop over all cards\r\n        let originalWords = flashcard.inverted ? flashcard.translations : flashcard.original;\r\n\r\n        originalWords.forEach(originalWord => {\r\n          if (noDuplicatesArray.includes(originalWord)) {\r\n            return;\r\n          } else {\r\n            noDuplicatesArray.push(originalWord);\r\n          }\r\n          // loop over all words in card\r\n          let regularExp = new RegExp(`\\\\b(${originalWord})\\\\b`, 'gi'); // set regular expression to replace words\r\n          elementHtml = elementHtml.replace(regularExp, match => {\r\n            return `<mark data-flashcardid=${flashcard._id} >${match + spanCode}</mark>`;\r\n          }); // update element html\r\n        });\r\n      });\r\n      pageElement.innerHTML = elementHtml; // update element html\r\n    }\r\n    // get rid of a tags styling, add classes\r\n    filterAnchorsOut();\r\n  }\r\n\r\n  function filterAnchorsOut() {\r\n    let listOfWords = document.getElementsByTagName('mark');\r\n    Array.from(listOfWords).forEach(curr => {\r\n      if (curr.textContent.endsWith(spanCode)) {\r\n        if (curr.parentNode.tagName !== 'A') {\r\n          console.log('got here');\r\n          curr.className = 'masterlingo__marked-word';\r\n          curr.addEventListener('click', handleMarkedWordClick);\r\n        }\r\n        curr.textContent = curr.textContent.split('-')[0];\r\n      }\r\n    });\r\n  }\r\n\r\n  function handleMarkedWordClick(e) {\r\n    console.log('word clicked');\r\n    const clickedWordEl = e.target;\r\n    const flashcardId = clickedWordEl.dataset.flashcardid;\r\n    const flashcard = flashcards.allFlashcards[flashcardId];\r\n    console.log(flashcard);\r\n    translationBox.show(clickedWordEl, flashcard);\r\n  }\r\n}\r\n\r\nrunContentScript();\r\n","function calcFactor(oldFac, quality) {\r\n  let newFac = oldFac + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));\r\n  if (newFac > 2.5) newFac = 2.5;\r\n  if (newFac < 1.3) newFac = 1.3;\r\n  return newFac;\r\n}\r\n\r\n/**\r\n * @params {number} a number between 0~5 representing the quality of review. 0 is the worse while 5 is the best.\r\n * @params {number} the factor of last schedual\r\n */\r\nfunction supermemo(quality, { schedule, factor, repetition }) {\r\n  let curSchedule,\r\n    newFactor,\r\n    newRepetition,\r\n    lastSchedule = schedule,\r\n    lastFactor = factor;\r\n\r\n  if (!repetition) {\r\n    newRepetition = 1;\r\n    newFactor = 2.5;\r\n  } else {\r\n    newRepetition = repetition + 1;\r\n    console.log('got here');\r\n    console.log(newRepetition);\r\n  }\r\n  if (quality < 3) {\r\n    console.log('quality under 3');\r\n    newRepetition = 0;\r\n    curSchedule = 0;\r\n\r\n    if (lastFactor) {\r\n      newFactor = calcFactor(lastFactor, quality);\r\n    }\r\n  } else {\r\n    if (lastFactor) {\r\n      newFactor = calcFactor(lastFactor, quality);\r\n      console.log(`new factor is ${newFactor}`);\r\n    }\r\n    curSchedule = Math.round(lastSchedule * newFactor);\r\n  }\r\n\r\n  if (newRepetition === 1) {\r\n    if (quality < 5) {\r\n      curSchedule = 2;\r\n    } else {\r\n      curSchedule = 6;\r\n    }\r\n  }\r\n  let dueDate = new Date();\r\n  if (quality >= 3) {\r\n    console.log('1b');\r\n    if (quality === 5) {\r\n      curSchedule = Math.round(curSchedule * 1.4);\r\n    }\r\n    dueDate = addSubtractDate.add(dueDate, Math.round(curSchedule / 2), 'days');\r\n    // only 1/2 of current schedule gets added compared to the app version where 100% gets added\r\n  }\r\n\r\n  console.log('before return' + newRepetition);\r\n  return {\r\n    factor: newFactor,\r\n    schedule: curSchedule,\r\n    isRepeatAgain: quality < 4,\r\n    repetition: newRepetition,\r\n    dueDate\r\n  };\r\n}\r\n\r\nexport default supermemo;\r\n"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClFA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5DA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACtGA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}